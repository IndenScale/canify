# Canify Agent 理解指南

## 核心概念类比

### 1. 编译器类比

Canify 的工作原理类似于编程语言编译器：

| Canify 概念 | 编译器概念        | 说明                       |
| ----------- | ----------------- | -------------------------- |
| 实体声明    | 变量/函数声明     | 定义可重用的信息单元       |
| 实体引用    | 函数调用/变量使用 | 在其他地方使用已定义的实体 |
| 符号表      | 符号表/作用域     | 维护所有实体的全局索引     |
| 验证引擎    | 编译器前端        | 检查语法和语义正确性       |

### 2. 验证阶段类比

| 验证阶段     | 编译器阶段 | 检查内容             |
| ------------ | ---------- | -------------------- |
| 符号发现     | 词法分析   | 基本语法、重复定义   |
| 引用关联     | 语法分析   | 引用关系、依赖关系   |
| 数据模型校验 | 语义分析   | 类型、格式、业务规则 |

## Agent 理解的关键模式

### 1. 实体声明模式

Agent 应该识别：

- 以 ````entity` 开头的代码块
- 包含 YAML 格式的元数据
- 必需字段：`type`, `id`, `name`
- 可选字段根据实体类型变化

```entity
type: project
id: my-project
name: 我的项目
budget: 100000
status: active
```

### 2. 实体引用模式

Agent 应该识别：

- 标准 Markdown 链接格式
- 使用 `entity://` 协议
- 引用已定义的实体 ID

```markdown
这个项目由 [项目经理](entity://project-manager) 负责。
```

### 3. 验证错误模式

Agent 应该理解常见的验证错误：

- **重复实体 ID**：同一 ID 被多次声明
- **悬空引用**：引用不存在的实体
- **类型错误**：字段值不符合预期类型
- **无效枚举值**：字段值不在允许的范围内

## Agent 交互模式

### 1. 信息提取模式

当 Agent 需要了解项目结构时：

```bash
canify lint . --verbose
```

### 2. 质量验证模式

当 Agent 需要验证文档质量时：

```bash
canify verify . --strict
```

### 3. 问题诊断模式

当 Agent 遇到验证错误时：

- 检查错误类型和位置
- 理解错误的具体含义
- 提供修复建议

## 最佳实践

### Agent 应该

1. **理解实体间的关系**：识别依赖和引用链
2. **维护符号表一致性**：确保所有引用都有对应的声明
3. **遵循数据模型约束**：遵守字段类型和枚举值限制
4. **利用验证反馈**：根据错误信息改进文档质量

### Agent 不应该

1. 忽略验证错误
2. 创建重复的实体 ID
3. 引用未定义的实体
4. 违反数据模型约束

## 扩展理解

### 未来功能预期

Agent 应该了解 Canify 的发展方向：

- **占位符处理**：支持 TBD/TODO 标记
- **分级验证**：Lax 模式 vs Strict 模式
- **交叉验证**：实体间的业务规则检查

通过理解这些模式，Agent 可以更好地与 Canify 协作，创建和维护高质量的文档即代码项目。
